@model CustomerIndexVM

@{
    ViewBag.title = "Välkommen till QApp";
}

<h3>Välkommen till QApp!</h3><br />
<h4>Vänligen ta en kölapp</h4>

<div id="showCardNumber">
    @Model.CardNumber
</div>

<div>
    <button type="button" class="btn btn-success btn-lg" id="joinQueueButton" onclick="joinqueue();"> Ställ dig i kö</button>

</div>

<div id="showNumbersBeforeYou">
    Personer före dig i kön: @Model.NumbersLeftInQueue
</div>

@*Knapp för att lämna kö*@
@*<div>
        <button  id="leaveQueue" onclick="leavequeue()" style="display:none"> Gå ur kö</button>
    </div>*@

@*<form asp-controller="Customer" asp-action="Index">
        <input type="submit" value="Ställ dig i kö" />
    </form>*@



<div id="queuealert" style="display:none"></div>


<script>
    function joinqueue() {
        $.ajax({
            url: "customer/GetCustomerCardNumber",
            success: function (result) {
                $("#showCardNumber").html(result.cardNumber);
                $("#joinQueue").addClass("button");
                $("#joinQueue").hide();
                //$("#leaveQueue").show();
                console.log(result.cardNumber);
                showposition();
                var interval = setInterval(showposition, 15000) //Ändra tillbaka
            }
        });
    }

    function showposition() {
        $.ajax({
            url: "customer/ShowPositionInQueue",
            success: function (result) {
                $("#showNumbersBeforeYou").html(result.numbersLeftInQueue);
                console.log(result.numbersLeftInQueue);

                if (result.numbersLeftInQueue > 0) {
                    $("#queuealert").html("Nu är det " + result.numbersLeftInQueue + " personer före dig i kön");
                    $("#queuealert").show();
                }
                else if (result.numbersLeftInQueue == 0) {
                    $("#queuealert").html("Du är näst på tur!");
                    $("#queuealert").show();

                }


                //Lägg till att stänga av timern
            }
        });
    }

    //Funktion för att lämna kö
    //function leavequeue() {
    //    $.ajax({
    //        url: "LeaveCustomerQueue",
    //        success: function () {
    //            $("#joinQueue").show();
    //            $("#leaveQueue").hide();

    //        }
    //    });

    //}

    //Anrop till databas för att hålla kön uppdaterad
</script>
