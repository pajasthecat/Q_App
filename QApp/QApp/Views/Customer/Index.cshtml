@model CustomerIndexVM
@{
    ViewBag.h3 = "Välkommen till QApp!";
}

<div id="showCardNumber">
    @Model.CardNumber
</div>

<div>
    <button type="button" class="btn btn-success btn-lg" id="joinQueue" onclick="joinqueue();"> Ställ dig i kö</button>

</div>

@*<div id="showNumbersBeforeYou">
    Personer före dig i kön: @Model.NumbersLeftInQueue
</div>*@

@*Knapp för att lämna kö*@
@*<div>
        <button  id="leaveQueue" onclick="leavequeue()" style="display:none"> Gå ur kö</button>
    </div>*@

@*<form asp-controller="Customer" asp-action="Index">
        <input type="submit" value="Ställ dig i kö" />
    </form>*@



<div id="queuealert" @*style="display:none"*@></div>


<script>
    var interval = 0;

    function joinqueue() {
        $.ajax({
            url: "customer/GetCustomerCardNumber",
            success: function (result) {
                $("#showCardNumber").html(result.cardNumber);
                $("#joinQueue").addClass("button");
                $("#joinQueue").hide();
                $("#queuealert").show();
                //$("#leaveQueue").show();
                console.log(result.cardNumber);
                showposition();
                interval = setInterval(showposition, 3000) //Ändra tillbaka
            }
        });
    }

    function showposition() {
        $.ajax({
            url: "customer/ShowPositionInQueue",
            success: function (result) {
                //$("#showNumbersBeforeYou").html(result.numbersLeftInQueue);
                //console.log(result.numbersLeftInQueue);
                $("#queuealert").html(result.message);

                if (result.cardNumber == 0)
                {
                    clearInterval(interval);
                    $("#showCardNumber").html(result.cardNumber);
                    $("#queuealert").hide();
                    $("#joinQueue").show();

                }


                //if (result.numbersLeftInQueue > 0) {
                //    $("#queuealert").html("Nu är det " + result.numbersLeftInQueue + " personer före dig i kön");
                //    $("#queuealert").show();
                //}
                //else if (result.numbersLeftInQueue == 0) {
                //    $("#queuealert").html("Du är näst på tur!");
                //    $("#queuealert").show();
                //}


                //Lägg till att stänga av timern

            }
        });
    }

    //Gör en funktion som tar emot signal om när personen får hjälp via en bool
    //Sätt då session id till null, nollställ sidan och redirecta till index

    //Funktion för att lämna kö
    //function leavequeue() {
    //    $.ajax({
    //        url: "LeaveCustomerQueue",
    //        success: function () {
    //            $("#joinQueue").show();
    //            $("#leaveQueue").hide();

    //        }
    //    });

    //}

    //Anrop till databas för att hålla kön uppdaterad
</script>
